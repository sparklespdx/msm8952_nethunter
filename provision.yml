---
- hosts: all
  tasks:
    - name: install openjdk 8
      apt:
        deb: "{{ item }}"
      with_items:
        - "http://archive.ubuntu.com/ubuntu/pool/universe/o/openjdk-8/openjdk-8-jre-headless_8u45-b14-1_amd64.deb"
        - "http://archive.ubuntu.com/ubuntu/pool/universe/o/openjdk-8/openjdk-8-jre_8u45-b14-1_amd64.deb"
        - "http://archive.ubuntu.com/ubuntu/pool/universe/o/openjdk-8/openjdk-8-jdk_8u45-b14-1_amd64.deb"

    - name: install build dependencies
      apt:
        name: "{{ item }}"
        state: present
      with_items:
        - "git-core"
        - "gnupg"
        - "flex"
        - "bison"
        - "gperf"
        - "build-essential"
        - "zip"
        - "curl"
        - "zlib1g-dev"
        - "gcc-multilib"
        - "g++-multilib"
        - "libc6-dev-i386"
        - "lib32ncurses5-dev"
        - "x11proto-core-dev"
        - "libx11-dev"
        - "lib32z-dev"
        - "ccache"
        - "libgl1-mesa-dev"
        - "libxml2-utils"
        - "xsltproc"
        - "unzip"
        - "python-networkx"

    - name: create build user
      user:
        name: build
        shell: /bin/bash
        createhome: yes

    - name: grab android kernel source
      become: true
      become_method: su
      become_user: build
      git:
        repo: https://github.com/LineageOS/android_kernel_motorola_msm8952.git
        dest: /home/build/android_kernel
        refspec: "+refs/cm-14.1/*:refs/heads/*"

    - name: grab kali nethunter source
      become: true
      become_method: su
      become_user: build
      git:
        repo: https://github.com/offensive-security/kali-nethunter.git
        dest: /home/build/kali-nethunter
        refspec: "+refs/master/*:refs/heads/*"
